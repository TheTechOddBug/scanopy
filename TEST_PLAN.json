{
  "branch": "fix-ghost-printing",
  "tests": [
    {
      "id": "toggle-persists-on-save",
      "category": "UI Toggle",
      "description": "The probe_raw_socket_ports setting persists after saving and reloading the discovery",
      "setup": "Create a Network discovery via the API on the default daemon with probe_raw_socket_ports set to true. Note the discovery name.",
      "steps": [
        "Navigate to the Discoveries page",
        "Open the discovery created by setup for editing",
        "Verify the 'Probe raw socket ports (9100-9107)' checkbox is checked",
        "Uncheck the checkbox, save, then reopen — verify it is now unchecked"
      ],
      "expected": "Checkbox state matches what was saved, both when set to true via API and after toggling to false in the UI.",
      "status": null,
      "feedback": null
    },
    {
      "id": "toggle-only-visible-for-network",
      "category": "UI Toggle",
      "description": "The raw socket ports checkbox only appears for Network discovery type",
      "steps": [
        "Open the create discovery modal",
        "Select 'Network' as the discovery type — verify the 'Probe raw socket ports (9100-9107)' checkbox is visible",
        "Switch to 'Docker' discovery type — verify the checkbox disappears",
        "Switch to 'Self Report' discovery type — verify the checkbox is not shown",
        "Switch back to 'Network' — verify the checkbox reappears"
      ],
      "expected": "The 'Probe raw socket ports' checkbox is only visible when Network discovery type is selected.",
      "status": null,
      "feedback": null
    },
    {
      "id": "toggle-help-text-shows-affected-services",
      "category": "UI Toggle",
      "description": "The raw socket ports checkbox shows dynamic help text listing affected services",
      "steps": [
        "Open the create discovery modal with Network type selected",
        "Locate the 'Probe raw socket ports (9100-9107)' checkbox",
        "Read the help text below it"
      ],
      "expected": "Help text includes 'May cause ghost printing on JetDirect printers' and 'Required to detect: Prometheus Node Exporter'.",
      "status": null,
      "feedback": null
    },
    {
      "id": "default-scan-skips-raw-socket-probes",
      "category": "Ghost Print Prevention",
      "description": "Default network discovery does not send HTTP probes to port 9100",
      "setup": "Create an ad-hoc Network discovery via the API with default settings (probe_raw_socket_ports=false). Run it via the API. After it completes, note the discovery ID.",
      "steps": [
        "Navigate to the Discoveries page and open the completed discovery",
        "Find any hosts that had port 9100 open",
        "Verify that no Prometheus Node Exporter service was detected on those hosts (since probing was off)",
        "Verify that JetDirect service IS listed (detected by port only, no HTTP probe needed)"
      ],
      "expected": "Hosts with port 9100 show JetDirect service but not Prometheus Node Exporter. No HTTP probe was sent to port 9100.",
      "status": null,
      "feedback": null
    },
    {
      "id": "opt-in-enables-node-exporter-detection",
      "category": "Ghost Print Prevention",
      "description": "Enabling raw socket port probing detects Prometheus Node Exporter",
      "setup": "Create an ad-hoc Network discovery via the API with probe_raw_socket_ports=true. Run it via the API. After it completes, note the discovery ID.",
      "steps": [
        "Navigate to the Discoveries page and open the completed discovery",
        "Find any hosts running Prometheus Node Exporter on port 9100",
        "Check the host's services list"
      ],
      "expected": "Prometheus Node Exporter is detected and listed as a service on the host.",
      "status": null,
      "feedback": null
    },
    {
      "id": "docker-discovery-detects-raw-socket-services",
      "category": "Regression",
      "description": "Docker discovery always probes raw socket ports (containers are never printers)",
      "setup": "Create a Docker discovery via the API on a daemon that has Docker socket access and a container exposing port 9100 with Prometheus Node Exporter. Run it via the API.",
      "steps": [
        "Navigate to the Discoveries page and open the completed Docker discovery",
        "Check services on the discovered container host",
        "Verify the Docker discovery edit modal does NOT show a 'Probe raw socket ports' checkbox"
      ],
      "expected": "Prometheus Node Exporter is detected on the container. No raw socket toggle exists for Docker discoveries.",
      "status": null,
      "feedback": null
    }
  ]
}
